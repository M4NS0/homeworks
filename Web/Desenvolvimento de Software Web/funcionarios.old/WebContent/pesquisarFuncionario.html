<!DOCTYPE html>
<html>
<head>
<meta charset="ISO-8859-1">
<title>Insert title here</title>
</head>
<body>
	<div id="mensagem"></div>
	<div id="divTabela" align="center"></div>
	<div id="divForm" align="center"></div>
	
	<!-- JQuery/Ajax Link  -->
	<script src="https://code.jquery.com/jquery-3.5.1.min.js"integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="crossorigin="anonymous"></script>
	<script	src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
	
	<script>
       $(document).ready(function(){
    	$.ajax({
    		     url : "http://localhost:8282/funcionario/ServletAll",
    		     type : 'get',
    		     data : { },
    		     beforeSend : function()
    		     {
    		          $("#mensagem").html("Analisando dados...");
    		     },
    		     
    		     success:function(msg)
    		     {
        			 let conteudo="";
        		     $("#divTabela").html("");
        		     let html="<table border=\"1\">";
      		    	 html+="<tr><td><strong>CÓDIGO<\strong></td>";
    		    	 html+="<td><strong>NOME</strong></td>";
    		    	 html+="<td><strong>CPF</strong></td>";
    		    	 html+="<td><strong>NASCIMENTO</strong></td>";
    		    	 html+="<td><strong>SALARIO</strong></td>";
    		    	 html+="<td><strong>CARGO</strong></td>";
    		    	 html+="<td><strong>DEPARTAMENTO</strong></td>";
    		    	 
    		    	 html+="<td><strong>EDITAR</strong></td>";
    		    	 html+="<td><strong>EXCLUIR</strong></td></tr>";

        		     for(let i=0;i < msg.length; i++)
        		     {
        		    	 html+="<tr><td style=\"text-align: center\">"+msg[i].id+"</td>";
        		    	 html+="<td style=\"text-align: center\">"+msg[i].nomeFuncionario+"</td>";
        		    	 html+="<td style=\"text-align: center\">"+msg[i].cpf+"</td>";
        		    	 html+="<td style=\"text-align: center\">"+msg[i].nascimento+"</td>";
        		    	 html+="<td style=\"text-align: center\">"+msg[i].salario+"</td>";
        		    	 html+="<td style=\"text-align: center\">"+msg[i].cargo+"</td>";
        		    	 html+="<td style=\"text-align: center\">"+msg[i].departamento+"</td>";
        		    	 
        		    	 html+="<td style=\"text-align: center\"><button id=\"btnEditar\" onclick='editar("+msg[i].id+")'>Editar</button></td>";
        		    	 html+="<td style=\"text-align: center\"><button id=\"btnExcluir\" onclick='excluir("+msg[i].id+")'>Excluir</button></td></tr>";
        		    	 
        		     }	 
        		     html+="</table>"
        		     html+="</br><center><button onclick=\"novo()\">Novo</button><\center>";

        		     
          		     $("#divTabela").html(html);
        		     $("#mensagem").html("");
        		     $("#divForm").html("");

    		    },
    	   		error:function(msg)
    	   		{
       		     alert(msg);
       		    }
       
    		     
    		});
            
    	  $.excluir = function (msg) {
    		   let codigo=msg;
    		   console.log(codigo);
    	  	   $.ajax(
    	  	   {
			   		     url : "http://localhost:8282/funcionario/ServletExcluirPorId",
			   		     type : 'get',
			   		     data : {
			   		    	      id:codigo
			   		     },
			   		     beforeSend : function(){
			   		          $("#mensagem").html("Analisando a solicitação...");
			   		     },
			   		     success: function(msg){
			   		    	 alert(msg);
			   		    	window.location.reload(true);
			   		     },
			   	 		 error: function(msg){
			      		     alert(msg);
			      		}
    	  	   });
    	};

  	    $.editar = function (msg) {
		   let codigo=msg;
		   console.log(codigo);
	  	   $.ajax(
	  	   {
		   		     url : "http://localhost:8282/funcionario/ServletExcluirPorId",
		   		     type : 'get',
		   		     data : {
		   		    	      id:codigo
		   		     },
		   		     beforeSend : function(){
		   		          $("#mensagem").html("Analisando a solicitação...");
		   		     },
		   		     success: function(msg){
		   		    	 alert(msg);
		   		    	window.location.reload(true);
		   		     },
		   	 		 error: function(msg){
		      		     alert(msg);
		      		}
	  	   });
	     };
	     
		    $.mostraForm = function () {
		     let html="";
	         html+="<br><br>";
	         html+="<b>Cadastro de Funcionários</b></br>";
	         html+="Código:<input id=\"idForm\" ></br>"; 
	         html+="Nome:<input id=\"nomeForm\"></br>"; 
	         html+="cpf:<input id=\"cpfForm\"></br>"; 
	         html+="Nascimento:<input id=\"nascimentoForm\"></br>";
	         html+="Salário:<input id=\"salarioForm\"></br>";
	         html+="Cargo:<input id=\"cargoForm\"></br>";
	         html+="Departamento:<input id=\"departamentoForm\"></br>";
	         
	         html+="<button onclick=\"salvar()\">SALVAR</button>";
	         html+="<button onclick=\"$.limpar()\">LIMPAR</button>";
	         
             $("#divForm").html(html);	           
	       		   
		    };
		    
		    $.salvar = function(){
		    	let codigo = $("#idForm").val();
		    	let nomeFuncionario = $("#nomeForm").val();
		    	let cpf = $("#cpfForm").val();
		    	let nascimento = $("#nascimentoForm").val();
		    	let salario = $("#salarioForm").val();
		    	let cargo = $("#cargoForm").val();
		    	let departamento = $("#departamentoForm").val();

		    	if (codigo === "")
		    	{
		    		codigo=0;
		    	}		
                if (nomeFuncionario.length ==0 || nomeFuncionario =="")
                {
                          alert("nome deve ser informado");	     
                }
                else
                {
                      //envio dos dados
                      $.enviarDadosCadastro(codigo,nomeFuncionario,cpf,nascimento,salario,cargo,departamento);
	            }
	    	}
	     
            $.enviarDadosCadastro = function(codigo,nomeFuncionario,cpf,nascimento,salario,cargo,departamento){
            	$.ajax(
            		
            		{
	       	   		     url : "http://localhost:8282/funcionario/ServletSalvarDados",
			   		     type : 'get',
			   		     data : {
			   		    	      id: codigo,
			   		    	      nomeFuncionario: nomeFuncionario,
			   		    	      cpf: cpf,
			   		    	      nascimento: nascimento,
			   		    	      salario: salario,
			   		    	      cargo: cargo,
			   		    	      departamento: departamento
			   		     },
			   		     beforeSend : function(){
			   		          $("#mensagem").html("Enviando / salvando dados...");
			   		     },
			   		     success: function(msg){
			   		    	 alert(msg[0].mensagem);
			   		    	window.location.reload(true);
			   		     },
			   	 		 error: function(msg){
			      		     alert(msg[0].mensagem);
			      		}
            	  }	     
			
                )
            }
            
    	    $.populaForm = function (codigo) {
    	    	
               	$.ajax(
                		
                		{
    	       	   		     url : "http://localhost:8282/funcionario/ServletConsultaPorId",
    			   		     type : 'get',
    			   		     data : {
    			   		    	      id: codigo,
    			   		     },
    			   		     beforeSend : function(){
    			   		          $("#mensagem").html("Consultando dados...");
    			   		     },
    			   		     success: function(msg){
    			   		    	 
    			   		    	 if (msg.id !=0)
    			   		    	 {
    			   		    		 $("#idForm").val(msg.id);
    			   		    		 $("#nomeForm").val(msg.nomeFuncionario);
    			   		    		 $("#cpfForm").val(msg.cpf);
    			   		    		 $("#nascimentoForm").val(msg.nascimento);
    			   		    		 $("#salarioForm").val(msg.salario);
    			   		    		 $("#cargoForm").val(msg.cargo);
    			   		    		 $("#departamentoForm").val(msg.departamento);
    			   		    	 }	 
   			   		    	
    			   		     },
    			   	 		 error: function(msg){
    			      		     alert(msg[0].mensagem);
    			      		}
                	  }	     
    			
                    )
   	       			   
   		    };
   		    
   	      $.limpar = function(){
   	    	  $("#divForm").html("");
   	      }
            
      });//fim jquery 
       
       function excluir(msg){
    	   $.excluir(msg);
       }
       function editar(msg){
    	   //$.excluir(msg);
    	  $.mostraForm();
    	  $.populaForm(msg);
       }
       
       function novo(){
    	   $.mostraForm();
    	  
       }

       function salvar(){
    	   $.salvar();
    	  
       }
   </script>
</body>
</html>